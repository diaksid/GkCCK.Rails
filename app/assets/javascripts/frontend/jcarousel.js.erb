(function ($, PRO) {
  var options = {
    wrap: 'circular',
    center: false,
    duration: 700,
    easing: 'easeOutSine',
    autoscroll: 5000,
    control: true,
    pagination: true,
    margin: 0,
    numbs: {
      0: 2,
      576: 3,
      768: 4,
      992: 5,
      1280: 6,
      1440: 7
    }
  }
  var carousel = function (element, options) {
    var scope = $(element)
    scope.find('.outer')
      .on('jcarousel:reload jcarousel:create', function () {
        var obj = $(this)
        var width = obj.innerWidth()
        var numb = 1
        for (var max in options.numbs) {
          if (max < width) {
            numb = options.numbs[max]
          } else {
            break
          }
        }
        obj.jcarousel('items').css({ width: Math.ceil(width / numb - options.margin) + 'px' })
        obj.css({ visibility: 'visible' })
      })
      .jcarousel({
        wrap: options.wrap,
        center: options.center,
        animation: {
          duration: options.duration,
          easing: options.easing
        }
      })
      .jcarouselAutoscroll({
        interval: options.autoscroll,
        target: '+=1',
        autostart: true
      })
    scope.find('.pagination')
      .jcarouselPagination({
        item: function (page) {
          $('<div>').addClass('icon' + (page === '1' ? ' active' : ''))
        }
      })
      .on('jcarouselpagination:active', '.icon', function () {
        $(this).addClass('active')
      })
      .on('jcarouselpagination:inactive', '.icon', function () {
        $(this).removeClass('active')
      })
    var ctrl = scope.find('.control')
    if (ctrl.length) {
      var obj = $('<div>').addClass('prev icon')
      ctrl.append(obj)
      obj.jcarouselControl({ target: '-=1' })
      obj = $('<div>').addClass('next icon')
      ctrl.append(obj)
      obj.jcarouselControl({ target: '+=1' })
    }
    $.lazyload(scope.find('[data-src]'), {
      scope: scope,
      attribute: 'src',
      event: 'jcarousel:animateend'
    })
  }

  PRO.carousel = function () {
    var obj = $('[data-carousel]')
    if (obj.length) {
      var fn = function () {
        obj.each(function () {
          carousel(this, options)
        })
      }
      if ($.jcarousel) {
        fn()
      } else {
        $.script('<%= asset_path('carousel.js') %>', fn)
      }
    }
    return this
  }
})($, PRO)
